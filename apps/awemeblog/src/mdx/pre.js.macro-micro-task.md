---
title: "è°ˆä¸€è°ˆæˆ‘çœ¼ä¸­çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"
author: "hanhan.rich"
description: "è°ˆä¸€è°ˆæˆ‘çœ¼ä¸­çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"
pubDate: "2021.03.31"
---
## å‰è¨€

æœ€è¿‘åœ¨å‡†å¤‡é¢è¯•ï¼Œè‡ªç„¶ä¹Ÿæ˜¯çœ‹äº†ä¸€ä¸‹æµè§ˆå™¨å’Œ node.js çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ã€‚æˆ‘å·²ç»æŠŠæœ€ç®€å•çš„æƒ³é€šäº†ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªç†è§£éå¸¸å®¹æ˜“å¸®åŠ©ç†è§£ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚

## å®éªŒä»£ç 

1. [å®éªŒä»£ç  1](https://runkit.com/hanhan9449/60598367fc0a04001a0ad3e6)

   ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a99e8bc52594be793088dce4415efeb~tplv-k3u1fbpfcp-watermark.image)

2. [å®éªŒä»£ç  2](https://runkit.com/hanhan9449/60598b098452e80019c76308)

   ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5fcf718d677403b8257c539774c2889~tplv-k3u1fbpfcp-watermark.image)

## ç®€å•ä»‹ç»

æˆ‘è®²è§£æœ€ç®€å•çš„æƒ…å†µï¼Œåé¢å†è¡¥å…… node.js ç­‰ç­‰çš„å¤æ‚å†…å®¹ã€‚

åˆ’é‡ç‚¹ï¼š**å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡åˆ†åˆ«æ˜¯ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œæ¯å½“ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæˆåä¼šå°†æ‰€æœ‰å¾®ä»»åŠ¡å‡ºåˆ—å¹¶æ‰§è¡Œã€‚**

### ä»€ä¹ˆæ˜¯å®ä»»åŠ¡

1. ä¸»çº¿ç¨‹
2. `setTimeout`é‡Œé¢çš„å‡½æ•°
3. `setInterval`é‡Œé¢çš„å‡½æ•°

### ä»€ä¹ˆæ˜¯å¾®ä»»åŠ¡

1. promise çš„ thenï¼Œcatch é‡Œé¢çš„å‡½æ•°

æ³¨æ„ âš ï¸

1ï¼š`new Promise`ä¸æ˜¯å¾®ä»»åŠ¡ï¼Œåé¢çš„ thenï¼Œcatch æ‰æ˜¯ã€‚ 2. promise çš„ then å’Œ catch ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼ˆæ–¹ä¾¿é“¾å¼è°ƒç”¨ï¼‰ï¼Œå¹¶æŠŠå½“å‰çš„ promise çŠ¶æ€ä» pending è½¬å˜åˆ° fulfilled æˆ–è€… rejectedã€‚

## å®éªŒä»£ç  1 è§£æ

1. é¦–å…ˆæˆ‘ä»¬å…ˆæ‰§è¡Œä¸»çº¿ç¨‹çš„ä»£ç 

   ```javascript
   currMacro = "ä¸»çº¿ç¨‹";
   macroList = [];
   microList = [];
   ```

2. é‡åˆ°ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ï¼ŒæŠŠå®šæ—¶å™¨ 1 æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹

   ```javascript
   currMacro = "ä¸»çº¿ç¨‹";
   macroList = ["å®šæ—¶å™¨1"];
   microList = [];
   ```

3. é‡åˆ°`new Promise`ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªä¸æ˜¯å¾®ä»»åŠ¡ï¼Œæ˜¯ä¸»çº¿ç¨‹ä¸­çš„æ™®é€šè¯­å¥ï¼Œç›´æ¥æ‰§è¡Œã€‚ç„¶åæŠŠåé¢çš„ then æ”¾è¿›å¾®ä»»åŠ¡ã€‚

   ```javascript
   currMacro = "ä¸»çº¿ç¨‹";
   macroList = ["å®šæ—¶å™¨1"];
   microList = ["ä¸»çº¿ç¨‹ä¸­çš„promiseçš„then"];
   ```

4. è¿è¡Œä¸‹é¢çš„ä¸¤ä¸ªå®šæ—¶å™¨ï¼Œå°†ä»–ä»¬æ”¾åˆ° macroList ä¸­ã€‚

   ```javascript
   currMacro = "ä¸»çº¿ç¨‹";
   macroList = ["å®šæ—¶å™¨1", "å®šæ—¶å™¨2", "å®šæ—¶å™¨3"];
   microList = ["ä¸»çº¿ç¨‹ä¸­çš„promiseçš„then"];
   ```

5. æ‰§è¡Œåˆ°æœ€åï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡äº†ã€‚

   ```javascript
   currMacro = null;
   macroList = ["å®šæ—¶å™¨1", "å®šæ—¶å™¨2", "å®šæ—¶å™¨3"];
   microList = [];
   ```

6. ç„¶åæ‰§è¡Œå®šæ—¶å™¨ 1ï¼ŒæŠŠå®šæ—¶å™¨ 1 é‡Œé¢é‚£ä¸ª promise çš„ then æ”¾è¿› microList ä¸­

   ```javascript
   currMacro = "å®šæ—¶å™¨1";
   macroList = ["å®šæ—¶å™¨2", "å®šæ—¶å™¨3"];
   microList = ["å®šæ—¶å™¨1ä¸­çš„promiseçš„then"];
   ```

7. ç„¶åå®šæ—¶å™¨ 1 ä¹Ÿæ‰§è¡Œå®Œäº†ï¼Œæ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ã€‚
8. Â·Â·Â·Â·Â·Â·ï¼Œä¸‹é¢çš„å†…å®¹éƒ½å·®ä¸å¤šï¼Œæˆ‘å°±ä¸è¯´äº†ã€‚

ä¸‹é¢æ˜¯å®éªŒ 1 çš„ç»“æœ ğŸ‘‡ï¼š

![å®éªŒ1ç»“æœ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf57d49358a24964ab0f91f4bd114a38~tplv-k3u1fbpfcp-watermark.image)

## å®éªŒä»£ç  2 è§£æ

å…ˆç»™ç­”æ¡ˆï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3967561d0aee4468b49854ef88fee1cd~tplv-k3u1fbpfcp-watermark.image)

å¤§å®¶æŒ‰ç…§å®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—è‡ªå·±æƒ³å§ã€‚æ³¨æ„å¾ˆå¤šä¸ª then é‚£ï¼Œæ‰§è¡Œäº†å½“å‰çš„å¾®ä»»åŠ¡ï¼Œåˆå°†åé¢çš„ then æˆ–è€… catch åŠ å…¥äº†å¾®ä»»åŠ¡çš„åˆ—è¡¨ï¼Œæ‰€ä»¥è¦ä¸€ç›´åšå®Œäº†æ‰€æœ‰çš„å¾®ä»»åŠ¡æ‰èƒ½å»æ‰§è¡Œä¸‹é¢çš„å¾®ä»»åŠ¡ã€‚
